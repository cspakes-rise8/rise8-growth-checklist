<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rise8 Growth Checklist - Dashboard</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: #0f0f0f;
            color: #e0e0e0;
            line-height: 1.6;
            min-height: 100vh;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        /* Header Styles */
        .header {
            background: rgba(20, 20, 20, 0.95);
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            border: 1px solid rgba(255, 0, 0, 0.2);
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 20px;
        }

        .logo {
            font-size: 1.8rem;
            font-weight: 700;
            color: #e0e0e0;
        }

        .logo span {
            color: #ff0000;
        }

        .header-info {
            display: flex;
            gap: 20px;
            align-items: center;
            flex-wrap: wrap;
        }

        .opportunity-name {
            font-size: 1.2rem;
            font-weight: 600;
            color: #ff0000;
        }

        .deadline {
            font-size: 0.9rem;
            color: #888;
        }

        /* Dashboard Styles */
        .dashboard-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            flex-wrap: wrap;
            gap: 20px;
        }

        .dashboard-title {
            font-size: 2rem;
            font-weight: 600;
        }

        .dashboard-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: rgba(20, 20, 20, 0.95);
            border-radius: 8px;
            padding: 20px;
            border: 1px solid rgba(255, 0, 0, 0.2);
            text-align: center;
        }

        .stat-value {
            font-size: 2.5rem;
            font-weight: 700;
            color: #ff0000;
            margin-bottom: 5px;
        }

        .stat-label {
            font-size: 0.9rem;
            color: #888;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        /* Checklist Cards */
        .checklists-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .checklist-card {
            background: rgba(20, 20, 20, 0.95);
            border-radius: 8px;
            padding: 20px;
            border: 1px solid rgba(255, 0, 0, 0.2);
            transition: all 0.2s;
            cursor: pointer;
            position: relative;
            overflow: hidden;
        }

        .checklist-card:hover {
            border-color: #ff0000;
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(255, 0, 0, 0.2);
        }

        .checklist-card.overdue {
            border-color: rgba(255, 0, 0, 0.5);
        }

        .checklist-card.overdue::before {
            content: 'OVERDUE';
            position: absolute;
            top: 10px;
            right: -30px;
            background: #ff0000;
            color: white;
            padding: 2px 40px;
            font-size: 0.7rem;
            font-weight: 600;
            transform: rotate(45deg);
        }

        .checklist-card h3 {
            font-size: 1.2rem;
            margin-bottom: 10px;
            color: #ff0000;
        }

        .checklist-meta {
            display: flex;
            flex-direction: column;
            gap: 5px;
            margin-bottom: 15px;
            font-size: 0.9rem;
            color: #888;
        }

        .checklist-progress {
            margin-bottom: 10px;
        }

        .progress-text {
            display: flex;
            justify-content: space-between;
            margin-bottom: 5px;
            font-size: 0.9rem;
        }

        .mini-progress-bar {
            width: 100%;
            height: 8px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 4px;
            overflow: hidden;
        }

        .mini-progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #ff0000, #cc0000);
            transition: width 0.3s ease;
        }

        .checklist-actions {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }

        .card-btn {
            padding: 6px 12px;
            background: rgba(255, 0, 0, 0.1);
            color: #e0e0e0;
            border: 1px solid rgba(255, 0, 0, 0.3);
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 0.85rem;
            flex: 1;
            text-align: center;
        }

        .card-btn:hover {
            background: rgba(255, 0, 0, 0.2);
            border-color: #ff0000;
        }

        .card-btn.danger {
            background: rgba(255, 0, 0, 0.2);
        }

        .card-btn.danger:hover {
            background: #ff0000;
            color: white;
        }

        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            background: rgba(20, 20, 20, 0.95);
            border-radius: 8px;
            border: 1px solid rgba(255, 0, 0, 0.2);
        }

        .empty-state h2 {
            font-size: 1.5rem;
            margin-bottom: 10px;
            color: #888;
        }

        .empty-state p {
            color: #666;
            margin-bottom: 20px;
        }

        /* Progress Bar */
        .progress-section {
            background: rgba(20, 20, 20, 0.95);
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            border: 1px solid rgba(255, 0, 0, 0.2);
        }

        .progress-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .progress-text {
            font-size: 1.1rem;
            font-weight: 600;
        }

        .progress-percentage {
            font-size: 1.4rem;
            font-weight: 700;
            color: #ff0000;
        }

        .progress-bar {
            width: 100%;
            height: 20px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            overflow: hidden;
            position: relative;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #ff0000, #cc0000);
            transition: width 0.3s ease;
            border-radius: 10px;
        }

        .progress-stats {
            display: flex;
            gap: 20px;
            margin-top: 10px;
            font-size: 0.9rem;
            color: #888;
        }

        /* Controls */
        .controls {
            background: rgba(20, 20, 20, 0.95);
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
            border: 1px solid rgba(255, 0, 0, 0.2);
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            align-items: center;
        }

        .btn {
            padding: 8px 16px;
            background: rgba(255, 0, 0, 0.1);
            color: #e0e0e0;
            border: 1px solid rgba(255, 0, 0, 0.3);
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 0.9rem;
        }

        .btn:hover {
            background: rgba(255, 0, 0, 0.2);
            border-color: #ff0000;
        }

        .btn-primary {
            background: #ff0000;
            color: white;
            border-color: #ff0000;
        }

        .btn-primary:hover {
            background: #cc0000;
        }

        /* Checklist Sections */
        .checklist-section {
            background: rgba(20, 20, 20, 0.95);
            border-radius: 8px;
            margin-bottom: 15px;
            border: 1px solid rgba(255, 0, 0, 0.2);
            overflow: hidden;
        }

        .section-header {
            padding: 15px 20px;
            background: rgba(255, 0, 0, 0.1);
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            user-select: none;
            transition: background 0.2s;
        }

        .section-header:hover {
            background: rgba(255, 0, 0, 0.15);
        }

        .section-title {
            font-weight: 600;
            font-size: 1.1rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .section-count {
            font-size: 0.9rem;
            color: #888;
            font-weight: normal;
        }

        .section-toggle {
            font-size: 1.2rem;
            transition: transform 0.2s;
        }

        .section-header.collapsed .section-toggle {
            transform: rotate(-90deg);
        }

        .section-tasks {
            max-height: 2000px;
            overflow: hidden;
            transition: max-height 0.3s ease;
        }

        .section-tasks.collapsed {
            max-height: 0;
        }

        /* Task Items */
        .task-item {
            padding: 12px 20px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            display: flex;
            align-items: center;
            gap: 12px;
            transition: background 0.2s;
            position: relative;
        }

        .task-item:hover {
            background: rgba(255, 255, 255, 0.05);
        }

        .task-checkbox {
            width: 20px;
            height: 20px;
            border: 2px solid rgba(255, 0, 0, 0.5);
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.2s;
            flex-shrink: 0;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .task-checkbox:hover {
            border-color: #ff0000;
        }

        .task-checkbox.checked {
            background: #ff0000;
            border-color: #ff0000;
        }

        .task-checkbox.checked::after {
            content: '✓';
            color: white;
            font-weight: bold;
        }

        .task-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .task-text {
            transition: all 0.2s;
        }

        .task-text.completed {
            text-decoration: line-through;
            opacity: 0.6;
        }

        .task-meta {
            display: flex;
            gap: 15px;
            font-size: 0.85rem;
            color: #888;
        }

        .task-controls {
            display: flex;
            gap: 8px;
            align-items: center;
            flex-wrap: wrap;
        }

        .task-input {
            padding: 6px 10px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 4px;
            color: #e0e0e0;
            font-size: 0.85rem;
            transition: all 0.2s;
        }

        .task-input:focus {
            outline: none;
            border-color: #ff0000;
        }

        .task-input.date-input {
            min-width: 140px;
        }

        .task-input.hours-input {
            width: 60px;
        }

        .task-input.assign-select {
            min-width: 120px;
        }

        .task-urgency {
            position: absolute;
            top: 5px;
            right: 5px;
            width: 8px;
            height: 8px;
            border-radius: 50%;
        }

        .urgency-overdue {
            background: #ff0000;
            box-shadow: 0 0 6px rgba(255, 0, 0, 0.6);
        }

        .urgency-due-soon {
            background: #ffc107;
            box-shadow: 0 0 6px rgba(255, 193, 7, 0.6);
        }

        .urgency-due-later {
            background: #4caf50;
            box-shadow: 0 0 6px rgba(76, 175, 80, 0.6);
        }

        /* Export Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }

        .modal.show {
            display: flex;
        }

        .modal-content {
            background: #1a1a1a;
            border-radius: 8px;
            padding: 30px;
            max-width: 500px;
            width: 90%;
            border: 1px solid rgba(255, 0, 0, 0.3);
        }

        .modal-header {
            font-size: 1.4rem;
            font-weight: 600;
            margin-bottom: 20px;
            color: #ff0000;
        }

        .export-options {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-bottom: 20px;
        }

        .export-option {
            padding: 15px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .export-option:hover {
            background: rgba(255, 0, 0, 0.1);
            border-color: rgba(255, 0, 0, 0.3);
        }

        .export-option h3 {
            font-size: 1.1rem;
            margin-bottom: 5px;
        }

        .export-option p {
            font-size: 0.9rem;
            color: #888;
        }

        .modal-actions {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
        }

        /* Landing Page */
        .landing {
            max-width: 600px;
            margin: 100px auto;
            text-align: center;
        }

        .landing h1 {
            font-size: 3rem;
            margin-bottom: 20px;
        }

        .landing-form {
            background: rgba(20, 20, 20, 0.95);
            border-radius: 8px;
            padding: 30px;
            border: 1px solid rgba(255, 0, 0, 0.2);
        }

        .form-group {
            margin-bottom: 20px;
            text-align: left;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: #ff0000;
        }

        .form-group input,
        .form-group select {
            width: 100%;
            padding: 10px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 4px;
            color: #e0e0e0;
            font-size: 1rem;
        }

        .form-group input:focus,
        .form-group select:focus {
            outline: none;
            border-color: #ff0000;
        }

        /* Filter Controls */
        .filter-controls {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .filter-btn {
            padding: 6px 12px;
            background: rgba(20, 20, 20, 0.95);
            color: #888;
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 0.85rem;
        }

        .filter-btn:hover {
            border-color: rgba(255, 0, 0, 0.5);
            color: #e0e0e0;
        }

        .filter-btn.active {
            background: rgba(255, 0, 0, 0.2);
            border-color: #ff0000;
            color: #ff0000;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }
            
            .header-content {
                flex-direction: column;
                align-items: flex-start;
            }
            
            .controls {
                justify-content: center;
            }
            
            .progress-stats {
                flex-direction: column;
                gap: 5px;
            }
            
            .checklists-grid {
                grid-template-columns: 1fr;
            }
            
            .dashboard-stats {
                grid-template-columns: 1fr;
            }
            
            .task-item {
                flex-direction: column;
                align-items: stretch;
                gap: 10px;
            }
            
            .task-controls {
                flex-direction: column;
                width: 100%;
            }
            
            .task-input {
                width: 100%;
            }
            
            .task-meta {
                flex-wrap: wrap;
            }
        }

        /* Utility */
        .hidden {
            display: none !important;
        }

        .text-muted {
            color: #888;
        }

        .text-success {
            color: #4caf50;
        }

        .text-danger {
            color: #ff0000;
        }

        /* Toast Notification */
        .toast {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: #333;
            color: white;
            padding: 15px 20px;
            border-radius: 4px;
            border: 1px solid rgba(255, 0, 0, 0.3);
            transform: translateY(100px);
            opacity: 0;
            transition: all 0.3s;
            z-index: 2000;
        }

        .toast.show {
            transform: translateY(0);
            opacity: 1;
        }

        .toast.success {
            border-color: #4caf50;
        }

        .toast.error {
            border-color: #ff0000;
        }

        /* Integration Styles */
        .integration-section {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
            border: 1px solid rgba(255, 0, 0, 0.2);
        }

        .integration-options {
            margin-left: 24px;
            padding: 10px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 4px;
        }

        .integration-status {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 4px 12px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            font-size: 0.85rem;
            margin-right: 10px;
        }

        .integration-status.hubspot {
            background: rgba(255, 122, 89, 0.2);
            color: #ff7a59;
            border: 1px solid rgba(255, 122, 89, 0.3);
        }

        .integration-status.slack {
            background: rgba(74, 21, 75, 0.2);
            color: #e01e5a;
            border: 1px solid rgba(224, 30, 90, 0.3);
        }

        /* Integration Modal */
        .integration-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }

        .integration-modal.show {
            display: flex;
        }

        .integration-modal-content {
            background: #1a1a1a;
            border-radius: 8px;
            padding: 30px;
            max-width: 500px;
            width: 90%;
            border: 1px solid rgba(255, 0, 0, 0.3);
            max-height: 80vh;
            overflow-y: auto;
        }

        .integration-log {
            background: rgba(0, 0, 0, 0.5);
            border-radius: 4px;
            padding: 15px;
            margin: 15px 0;
            font-family: monospace;
            font-size: 0.85rem;
            line-height: 1.5;
        }

        .log-entry {
            margin: 5px 0;
            display: flex;
            gap: 10px;
        }

        .log-entry.success {
            color: #4caf50;
        }

        .log-entry.info {
            color: #2196f3;
        }

        .log-entry.error {
            color: #ff0000;
        }

        /* Back Button */
        .back-btn {
            display: inline-flex;
            align-items: center;
            gap: 5px;
            padding: 8px 16px;
            background: rgba(255, 255, 255, 0.05);
            color: #e0e0e0;
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 0.9rem;
            text-decoration: none;
            margin-bottom: 20px;
        }

        .back-btn:hover {
            background: rgba(255, 0, 0, 0.1);
            border-color: rgba(255, 0, 0, 0.3);
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Dashboard Page -->
        <div id="dashboardPage">
            <div class="header">
                <div class="header-content">
                    <div class="logo">RISE<span>8</span> Growth Tracker</div>
                    <button class="btn btn-primary" onclick="showNewChecklistForm()">+ New Checklist</button>
                </div>
            </div>

            <div class="dashboard-header">
                <h1 class="dashboard-title">Active Proposals</h1>
            </div>

            <div class="dashboard-stats">
                <div class="stat-card">
                    <div class="stat-value" id="activeCount">0</div>
                    <div class="stat-label">Active Proposals</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="avgProgress">0%</div>
                    <div class="stat-label">Average Progress</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="overdueCount">0</div>
                    <div class="stat-label">Overdue</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="totalTasks">0</div>
                    <div class="stat-label">Total Tasks</div>
                </div>
            </div>

            <div class="filter-controls">
                <button class="filter-btn active" onclick="filterChecklists('all')">All</button>
                <button class="filter-btn" onclick="filterChecklists('active')">In Progress</button>
                <button class="filter-btn" onclick="filterChecklists('overdue')">Overdue</button>
                <button class="filter-btn" onclick="filterChecklists('completed')">Completed</button>
            </div>

            <div id="checklistsContainer" class="checklists-grid"></div>

            <div id="emptyState" class="empty-state hidden">
                <h2>No Active Proposals</h2>
                <p>Start tracking your first proposal by clicking the button above.</p>
                <button class="btn btn-primary" onclick="showNewChecklistForm()">+ Create Your First Checklist</button>
            </div>
        </div>

        <!-- Landing/New Checklist Page -->
        <div id="landingPage" class="landing hidden">
            <button class="back-btn" onclick="showDashboard()">← Back to Dashboard</button>
            <h1>Rise<span style="color: #ff0000;">8</span> Growth Checklist</h1>
            <p class="text-muted" style="margin-bottom: 30px;">Create a new proposal checklist</p>
            
            <div class="landing-form">
                <div class="form-group">
                    <label for="opportunityName">Opportunity Name *</label>
                    <input type="text" id="opportunityName" placeholder="e.g., DISA Cloud Migration" required>
                </div>
                
                <div class="form-group">
                    <label for="proposalDeadline">Proposal Deadline *</label>
                    <input type="date" id="proposalDeadline" required>
                </div>
                
                <div class="form-group">
                    <label for="proposalType">Proposal Type</label>
                    <select id="proposalType">
                        <option value="prime">Prime Contractor</option>
                        <option value="subcontractor">Subcontractor</option>
                        <option value="sbir">SBIR/STTR</option>
                        <option value="gsa">GSA Schedule</option>
                        <option value="recompete">Recompete</option>
                    </select>
                </div>
                
                <div class="integration-section">
                    <h3 style="color: #ff0000; margin-bottom: 15px; font-size: 1.1rem;">🔗 Integrations</h3>
                    
                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="hubspotEnabled" style="margin-right: 8px;">
                            Create HubSpot Deal
                        </label>
                        <div id="hubspotOptions" class="integration-options hidden" style="margin-top: 10px;">
                            <input type="text" id="hubspotDealValue" placeholder="Deal value (e.g., $5M)" 
                                   style="width: 100%; margin-bottom: 10px; padding: 8px;">
                            <select id="hubspotPipeline" style="width: 100%; padding: 8px;">
                                <option value="growth">Growth Pipeline</option>
                                <option value="federal">Federal Pipeline</option>
                                <option value="commercial">Commercial Pipeline</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="slackEnabled" style="margin-right: 8px;">
                            Post to Slack Channel
                        </label>
                        <div id="slackOptions" class="integration-options hidden" style="margin-top: 10px;">
                            <select id="slackChannel" style="width: 100%; padding: 8px;">
                                <option value="hubspot-updates">#hubspot-updates</option>
                                <option value="proposals">#proposals</option>
                                <option value="growth-team">#growth-team</option>
                                <option value="general">#general</option>
                            </select>
                        </div>
                    </div>
                </div>
                
                <button class="btn btn-primary" style="width: 100%; padding: 12px; font-size: 1.1rem;" onclick="initializeChecklist()">
                    Start Checklist
                </button>
            </div>
        </div>

        <!-- Checklist Page -->
        <div id="checklistPage" class="hidden">
            <button class="back-btn" onclick="showDashboard()">← Back to Dashboard</button>
            
            <div class="header">
                <div class="header-content">
                    <div class="logo">RISE<span>8</span></div>
                    <div class="header-info">
                        <div>
                            <div class="opportunity-name" id="displayOpportunityName"></div>
                            <div class="deadline" id="displayDeadline"></div>
                        </div>
                        <div id="integrationStatuses" style="display: flex; align-items: center; gap: 10px;"></div>
                    </div>
                </div>
            </div>

            <div class="progress-section">
                <div class="progress-header">
                    <span class="progress-text">Overall Progress</span>
                    <span class="progress-percentage" id="progressPercentage">0%</span>
                </div>
                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill" style="width: 0%"></div>
                </div>
                <div class="progress-stats">
                    <span id="completedCount">0 completed</span>
                    <span>•</span>
                    <span id="totalCount">0 total tasks</span>
                    <span>•</span>
                    <span id="remainingCount">0 remaining</span>
                </div>
            </div>

            <div class="controls">
                <button class="btn" onclick="toggleAllSections()">Expand/Collapse All</button>
                <button class="btn" onclick="showExportModal()">Export Progress</button>
                <button class="btn" onclick="syncIntegrations()">Sync Integrations</button>
                <button class="btn" onclick="resetProgress()">Reset Progress</button>
            </div>

            <div id="checklistContainer"></div>
        </div>
    </div>

    <!-- Export Modal -->
    <div id="exportModal" class="modal">
        <div class="modal-content">
            <h2 class="modal-header">Export Progress</h2>
            <div class="export-options">
                <div class="export-option" onclick="exportAsText()">
                    <h3>📄 Text Report</h3>
                    <p>Simple text format for emails or documents</p>
                </div>
                <div class="export-option" onclick="exportAsCSV()">
                    <h3>📊 CSV Spreadsheet</h3>
                    <p>Import into Excel or Google Sheets</p>
                </div>
                <div class="export-option" onclick="exportAsJSON()">
                    <h3>💾 JSON Backup</h3>
                    <p>Complete data backup for restoration</p>
                </div>
            </div>
            <div class="modal-actions">
                <button class="btn" onclick="hideExportModal()">Cancel</button>
            </div>
        </div>
    </div>

    <!-- Integration Modal -->
    <div id="integrationModal" class="integration-modal">
        <div class="integration-modal-content">
            <h2 class="modal-header">🚀 Creating Integrations</h2>
            <div id="integrationLog" class="integration-log"></div>
            <div class="modal-actions">
                <button class="btn" id="integrationDoneBtn" onclick="closeIntegrationModal()" style="display: none;">Done</button>
            </div>
        </div>
    </div>

    <!-- Toast Notification -->
    <div id="toast" class="toast"></div>

    <script>
        // Global state
        let allChecklists = {};
        let currentChecklistId = null;
        let currentFilter = 'all';

        // Task data structure by proposal type with default hours
        const taskTemplates = {
            prime: {
                "Administration": [
                    { text: "Receive and distribute formal RFP", hours: 2 },
                    { text: "Create proposal folder structure", hours: 1 },
                    { text: "Log opportunity in pipeline tracker", hours: 1 },
                    { text: "Assign proposal manager", hours: 2 },
                    { text: "Create internal communication channel", hours: 1 },
                    { text: "Develop proposal schedule with milestones", hours: 4 },
                    { text: "Create compliance matrix", hours: 6 },
                    { text: "Schedule kickoff meeting", hours: 2 }
                ],
                "Partner Coordination": [
                    { text: "Identify teaming partners", hours: 8 },
                    { text: "Send and collect NDAs", hours: 4 },
                    { text: "Draft teaming agreements", hours: 12 },
                    { text: "Distribute RFP to partners", hours: 2 },
                    { text: "Schedule partner meetings", hours: 3 },
                    { text: "Collect partner inputs", hours: 6 }
                ],
                "Solution Development": [
                    { text: "Analyze requirements", hours: 8 },
                    { text: "Develop technical approach", hours: 16 },
                    { text: "Create solution architecture", hours: 12 },
                    { text: "Identify key personnel", hours: 6 },
                    { text: "Map past performance", hours: 6 },
                    { text: "Define win themes", hours: 8 }
                ],
                "Writing & Review": [
                    { text: "Assign section writers", hours: 2 },
                    { text: "Create writing templates", hours: 4 },
                    { text: "Draft executive summary", hours: 8 },
                    { text: "Write technical volume", hours: 24 },
                    { text: "Write management volume", hours: 16 },
                    { text: "Conduct pink team review", hours: 8 },
                    { text: "Incorporate review feedback", hours: 12 },
                    { text: "Final proofreading", hours: 8 }
                ],
                "Pricing": [
                    { text: "Develop cost model", hours: 12 },
                    { text: "Gather vendor quotes", hours: 6 },
                    { text: "Calculate labor rates", hours: 8 },
                    { text: "Complete pricing volume", hours: 12 },
                    { text: "Pricing review and approval", hours: 4 }
                ],
                "Submission": [
                    { text: "Final compliance check", hours: 6 },
                    { text: "Package all volumes", hours: 4 },
                    { text: "Prepare submission materials", hours: 4 },
                    { text: "Submit proposal", hours: 2 }
                ]
            },
            subcontractor: {
                "Administration": [
                    { text: "Review teaming agreement", hours: 2 },
                    { text: "Create internal folder", hours: 1 },
                    { text: "Assign team members", hours: 2 },
                    { text: "Schedule internal meetings", hours: 1 }
                ],
                "Technical Response": [
                    { text: "Analyze SOW requirements", hours: 4 },
                    { text: "Develop technical approach", hours: 8 },
                    { text: "Write technical sections", hours: 12 },
                    { text: "Internal review", hours: 4 }
                ],
                "Pricing": [
                    { text: "Develop cost estimates", hours: 8 },
                    { text: "Submit pricing to prime", hours: 2 }
                ],
                "Submission": [
                    { text: "Final review", hours: 4 },
                    { text: "Submit to prime contractor", hours: 2 }
                ]
            },
            sbir: {
                "Administration": [
                    { text: "Review solicitation", hours: 2 },
                    { text: "Confirm eligibility", hours: 1 },
                    { text: "Register in required systems", hours: 2 },
                    { text: "Create project folder", hours: 1 }
                ],
                "Technical Development": [
                    { text: "Define innovation", hours: 8 },
                    { text: "Research prior art", hours: 6 },
                    { text: "Develop technical approach", hours: 12 },
                    { text: "Create project timeline", hours: 4 }
                ],
                "Writing": [
                    { text: "Write technical narrative", hours: 16 },
                    { text: "Develop commercialization plan", hours: 8 },
                    { text: "Create required forms", hours: 4 },
                    { text: "Final review", hours: 4 }
                ],
                "Submission": [
                    { text: "Upload to submission portal", hours: 2 },
                    { text: "Verify submission", hours: 1 }
                ]
            },
            gsa: {
                "Preparation": [
                    { text: "Review GSA requirements", hours: 4 },
                    { text: "Gather required documents", hours: 6 },
                    { text: "Verify registrations", hours: 2 }
                ],
                "Documentation": [
                    { text: "Complete GSA forms", hours: 8 },
                    { text: "Prepare pricing sheets", hours: 6 },
                    { text: "Compile past performance", hours: 4 }
                ],
                "Submission": [
                    { text: "Submit to GSA", hours: 2 },
                    { text: "Track status", hours: 1 }
                ]
            },
            recompete: {
                "Administration": [
                    { text: "Review current contract", hours: 4 },
                    { text: "Analyze changes in requirements", hours: 6 },
                    { text: "Create recompete folder", hours: 1 },
                    { text: "Assign recompete team", hours: 2 }
                ],
                "Lessons Learned": [
                    { text: "Document current performance", hours: 8 },
                    { text: "Identify improvements", hours: 6 },
                    { text: "Gather customer feedback", hours: 4 },
                    { text: "Update past performance", hours: 6 }
                ],
                "Solution Update": [
                    { text: "Refine technical approach", hours: 12 },
                    { text: "Update staffing plan", hours: 8 },
                    { text: "Enhance value proposition", hours: 8 }
                ],
                "Writing & Review": [
                    { text: "Update proposal sections", hours: 16 },
                    { text: "Emphasize incumbent advantages", hours: 8 },
                    { text: "Conduct reviews", hours: 8 },
                    { text: "Finalize proposal", hours: 6 }
                ],
                "Submission": [
                    { text: "Final compliance check", hours: 4 },
                    { text: "Submit proposal", hours: 2 }
                ]
            }
        };

        // Team members for assignment
        const teamMembers = ["Carlo Viray", "Clayton Spakes", "Shanna Chen", "Bree Knight"];

        // Load all checklists from localStorage
        function loadAllChecklists() {
            const saved = localStorage.getItem('rise8-all-checklists');
            if (saved) {
                allChecklists = JSON.parse(saved);
            }
        }

        // Save all checklists to localStorage
        function saveAllChecklists() {
            localStorage.setItem('rise8-all-checklists', JSON.stringify(allChecklists));
        }

        // Generate unique ID
        function generateId() {
            return 'checklist-' + Date.now() + '-' + Math.random().toString(36).substr(2, 9);
        }

        // Show toast notification
        function showToast(message, type = 'success') {
            const toast = document.getElementById('toast');
            toast.textContent = message;
            toast.className = `toast show ${type}`;
            setTimeout(() => {
                toast.classList.remove('show');
            }, 3000);
        }

        // Show dashboard
        function showDashboard() {
            document.getElementById('dashboardPage').classList.remove('hidden');
            document.getElementById('landingPage').classList.add('hidden');
            document.getElementById('checklistPage').classList.add('hidden');
            renderDashboard();
        }

        // Show new checklist form
        function showNewChecklistForm() {
            document.getElementById('dashboardPage').classList.add('hidden');
            document.getElementById('landingPage').classList.remove('hidden');
            document.getElementById('checklistPage').classList.add('hidden');
            
            // Clear form
            document.getElementById('opportunityName').value = '';
            document.getElementById('proposalDeadline').value = '';
            document.getElementById('proposalType').value = 'prime';
        }

        // Render dashboard
        function renderDashboard() {
            const container = document.getElementById('checklistsContainer');
            const checklistArray = Object.values(allChecklists);
            
            // Apply filter
            let filteredChecklists = checklistArray;
            if (currentFilter === 'active') {
                filteredChecklists = checklistArray.filter(c => c.progress < 100);
            } else if (currentFilter === 'overdue') {
                filteredChecklists = checklistArray.filter(c => {
                    const deadline = new Date(c.proposalDeadline);
                    return deadline < new Date() && c.progress < 100;
                });
            } else if (currentFilter === 'completed') {
                filteredChecklists = checklistArray.filter(c => c.progress === 100);
            }

            // Update stats
            updateDashboardStats();

            // Show empty state if no checklists
            if (checklistArray.length === 0) {
                document.getElementById('emptyState').classList.remove('hidden');
                container.innerHTML = '';
                return;
            } else {
                document.getElementById('emptyState').classList.add('hidden');
            }

            // Render checklist cards
            container.innerHTML = filteredChecklists.map(checklist => {
                const deadline = new Date(checklist.proposalDeadline);
                const today = new Date();
                const daysUntil = Math.ceil((deadline - today) / (1000 * 60 * 60 * 24));
                const isOverdue = daysUntil < 0 && checklist.progress < 100;
                
                return `
                    <div class="checklist-card ${isOverdue ? 'overdue' : ''}" onclick="openChecklist('${checklist.id}')">
                        <h3>${checklist.opportunityName}</h3>
                        <div class="checklist-meta">
                            <div>Type: ${checklist.proposalType.charAt(0).toUpperCase() + checklist.proposalType.slice(1)}</div>
                            <div>Deadline: ${deadline.toLocaleDateString()} (${Math.abs(daysUntil)} days ${daysUntil < 0 ? 'ago' : 'left'})</div>
                            <div>Created: ${new Date(checklist.created).toLocaleDateString()}</div>
                        </div>
                        <div class="checklist-progress">
                            <div class="progress-text">
                                <span>Progress</span>
                                <span>${checklist.progress}%</span>
                            </div>
                            <div class="mini-progress-bar">
                                <div class="mini-progress-fill" style="width: ${checklist.progress}%"></div>
                            </div>
                        </div>
                        <div class="checklist-actions">
                            <button class="card-btn" onclick="event.stopPropagation(); exportChecklistData('${checklist.id}')">Export</button>
                            <button class="card-btn danger" onclick="event.stopPropagation(); deleteChecklist('${checklist.id}')">Delete</button>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // Update dashboard statistics
        function updateDashboardStats() {
            const checklistArray = Object.values(allChecklists);
            const activeChecklists = checklistArray.filter(c => c.progress < 100);
            const overdueChecklists = checklistArray.filter(c => {
                const deadline = new Date(c.proposalDeadline);
                return deadline < new Date() && c.progress < 100;
            });
            
            const totalProgress = checklistArray.reduce((sum, c) => sum + c.progress, 0);
            const avgProgress = checklistArray.length > 0 ? Math.round(totalProgress / checklistArray.length) : 0;
            
            const totalTaskCount = checklistArray.reduce((sum, c) => sum + c.totalTasks, 0);
            
            document.getElementById('activeCount').textContent = activeChecklists.length;
            document.getElementById('avgProgress').textContent = avgProgress + '%';
            document.getElementById('overdueCount').textContent = overdueChecklists.length;
            document.getElementById('totalTasks').textContent = totalTaskCount;
        }

        // Filter checklists
        function filterChecklists(filter) {
            currentFilter = filter;
            
            // Update button states
            document.querySelectorAll('.filter-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            
            renderDashboard();
        }

        // Delete checklist
        function deleteChecklist(checklistId) {
            if (confirm('Are you sure you want to delete this checklist? This cannot be undone.')) {
                delete allChecklists[checklistId];
                saveAllChecklists();
                renderDashboard();
                showToast('Checklist deleted', 'success');
            }
        }

        // Export checklist data
        function exportChecklistData(checklistId) {
            currentChecklistId = checklistId;
            showExportModal();
        }

        // Open checklist
        function openChecklist(checklistId) {
            currentChecklistId = checklistId;
            showChecklistPage();
        }

        // Initialize new checklist
        function initializeChecklist() {
            const name = document.getElementById('opportunityName').value.trim();
            const deadline = document.getElementById('proposalDeadline').value;
            const type = document.getElementById('proposalType').value;

            if (!name || !deadline) {
                showToast('Please fill in all required fields', 'error');
                return;
            }

            const checklistId = generateId();
            const template = taskTemplates[type];
            
            // Create checklist object
            const checklist = {
                id: checklistId,
                opportunityName: name,
                proposalDeadline: deadline,
                proposalType: type,
                created: new Date().toISOString(),
                tasks: {},
                sectionStates: {},
                progress: 0,
                totalTasks: 0,
                completedTasks: 0,
                integrations: {
                    hubspot: {
                        enabled: document.getElementById('hubspotEnabled').checked,
                        dealId: null,
                        dealValue: document.getElementById('hubspotDealValue').value,
                        pipeline: document.getElementById('hubspotPipeline').value
                    },
                    slack: {
                        enabled: document.getElementById('slackEnabled').checked,
                        channel: document.getElementById('slackChannel').value,
                        threadTs: null
                    }
                }
            };

            // Calculate default due dates based on deadline
            const deadlineDate = new Date(deadline);
            let taskIndex = 0;

            // Initialize tasks
            Object.keys(template).forEach(section => {
                checklist.sectionStates[section] = false; // not collapsed
                template[section].forEach((taskData, index) => {
                    const taskId = `${section}-${index}`;
                    
                    // Calculate suggested due date (spread tasks evenly before deadline)
                    const totalDays = Math.ceil((deadlineDate - new Date()) / (1000 * 60 * 60 * 24));
                    const daysPerTask = Math.floor(totalDays / Object.values(template).flat().length);
                    const suggestedDueDate = new Date();
                    suggestedDueDate.setDate(suggestedDueDate.getDate() + (taskIndex * daysPerTask));
                    
                    checklist.tasks[taskId] = {
                        text: taskData.text,
                        completed: false,
                        section: section,
                        assignedTo: '',
                        dueDate: suggestedDueDate.toISOString().split('T')[0],
                        estimatedHours: taskData.hours
                    };
                    checklist.totalTasks++;
                    taskIndex++;
                });
            });

            // Save to all checklists
            allChecklists[checklistId] = checklist;
            saveAllChecklists();
            
            currentChecklistId = checklistId;

            // Process integrations if enabled
            if (checklist.integrations.hubspot.enabled || checklist.integrations.slack.enabled) {
                processIntegrations(checklist);
            } else {
                showChecklistPage();
            }
        }

        // Show checklist page
        function showChecklistPage() {
            document.getElementById('dashboardPage').classList.add('hidden');
            document.getElementById('landingPage').classList.add('hidden');
            document.getElementById('checklistPage').classList.remove('hidden');
            
            const checklist = allChecklists[currentChecklistId];
            
            // Update header
            document.getElementById('displayOpportunityName').textContent = checklist.opportunityName;
            const deadline = new Date(checklist.proposalDeadline);
            const daysUntil = Math.ceil((deadline - new Date()) / (1000 * 60 * 60 * 24));
            document.getElementById('displayDeadline').textContent = 
                `Due: ${deadline.toLocaleDateString()} (${daysUntil} days)`;
            
            renderChecklist();
            updateProgress();
        }

        // Render the checklist
        function renderChecklist() {
            const checklist = allChecklists[currentChecklistId];
            const container = document.getElementById('checklistContainer');
            const template = taskTemplates[checklist.proposalType];
            let html = '';

            Object.keys(template).forEach(section => {
                const sectionTasks = template[section];
                const isCollapsed = checklist.sectionStates[section];
                const completedInSection = sectionTasks.filter((_, index) => 
                    checklist.tasks[`${section}-${index}`]?.completed
                ).length;

                html += `
                    <div class="checklist-section">
                        <div class="section-header ${isCollapsed ? 'collapsed' : ''}" onclick="toggleSection('${section}')">
                            <div class="section-title">
                                ${section}
                                <span class="section-count">(${completedInSection}/${sectionTasks.length})</span>
                            </div>
                            <div class="section-toggle">▼</div>
                        </div>
                        <div class="section-tasks ${isCollapsed ? 'collapsed' : ''}">
                `;

                sectionTasks.forEach((taskData, index) => {
                    const taskId = `${section}-${index}`;
                    const task = checklist.tasks[taskId];
                    const isCompleted = task?.completed || false;
                    
                    // Calculate urgency
                    let urgencyClass = '';
                    if (task.dueDate) {
                        const daysUntil = Math.ceil((new Date(task.dueDate) - new Date()) / (1000 * 60 * 60 * 24));
                        if (daysUntil < 0 && !isCompleted) urgencyClass = 'urgency-overdue';
                        else if (daysUntil <= 3 && !isCompleted) urgencyClass = 'urgency-due-soon';
                        else if (daysUntil <= 7 && !isCompleted) urgencyClass = 'urgency-due-later';
                    }
                    
                    html += `
                        <div class="task-item">
                            ${urgencyClass ? `<div class="task-urgency ${urgencyClass}"></div>` : ''}
                            <div class="task-checkbox ${isCompleted ? 'checked' : ''}" 
                                 onclick="toggleTask('${taskId}')"></div>
                            <div class="task-content">
                                <div class="task-text ${isCompleted ? 'completed' : ''}">${task.text}</div>
                                <div class="task-meta">
                                    ${task.assignedTo ? `<span>👤 ${task.assignedTo.split(' ')[0]}</span>` : ''}
                                    ${task.dueDate ? `<span>📅 ${new Date(task.dueDate).toLocaleDateString()}</span>` : ''}
                                    <span>⏱️ ${task.estimatedHours}h</span>
                                </div>
                            </div>
                            <div class="task-controls">
                                <select class="task-input assign-select" 
                                        onchange="updateTaskAssignment('${taskId}', this.value)"
                                        value="${task.assignedTo || ''}">
                                    <option value="">Unassigned</option>
                                    ${teamMembers.map(member => 
                                        `<option value="${member}" ${task.assignedTo === member ? 'selected' : ''}>${member.split(' ')[0]}</option>`
                                    ).join('')}
                                </select>
                                <input type="date" 
                                       class="task-input date-input" 
                                       value="${task.dueDate || ''}"
                                       onchange="updateTaskDueDate('${taskId}', this.value)">
                                <input type="number" 
                                       class="task-input hours-input" 
                                       value="${task.estimatedHours || 0}"
                                       min="0.5" 
                                       step="0.5"
                                       onchange="updateTaskHours('${taskId}', this.value)">
                            </div>
                        </div>
                    `;
                });

                html += `
                        </div>
                    </div>
                `;
            });

            container.innerHTML = html;
        }

        // Toggle task completion
        function toggleTask(taskId) {
            const checklist = allChecklists[currentChecklistId];
            checklist.tasks[taskId].completed = !checklist.tasks[taskId].completed;
            
            // Update counts and progress
            checklist.completedTasks = Object.values(checklist.tasks).filter(t => t.completed).length;
            checklist.progress = Math.round((checklist.completedTasks / checklist.totalTasks) * 100);
            
            saveAllChecklists();
            renderChecklist();
            updateProgress();
            
            // Auto-sync if task is completed and integrations are enabled
            if (checklist.tasks[taskId].completed && 
                (checklist.integrations?.hubspot?.enabled || checklist.integrations?.slack?.enabled)) {
                // Throttle auto-sync to every 5 completed tasks
                if (checklist.completedTasks % 5 === 0) {
                    showToast('Auto-syncing progress to integrations...', 'info');
                    setTimeout(() => syncIntegrations(), 1000);
                }
            }
        }

        // Update task assignment
        function updateTaskAssignment(taskId, assignedTo) {
            const checklist = allChecklists[currentChecklistId];
            checklist.tasks[taskId].assignedTo = assignedTo;
            saveAllChecklists();
            showToast('Assignment updated', 'success');
        }

        // Update task due date
        function updateTaskDueDate(taskId, dueDate) {
            const checklist = allChecklists[currentChecklistId];
            checklist.tasks[taskId].dueDate = dueDate;
            saveAllChecklists();
            renderChecklist(); // Re-render to update urgency indicators
        }

        // Update task hours
        function updateTaskHours(taskId, hours) {
            const checklist = allChecklists[currentChecklistId];
            checklist.tasks[taskId].estimatedHours = parseFloat(hours) || 0;
            saveAllChecklists();
        }

        // Toggle section collapse
        function toggleSection(section) {
            const checklist = allChecklists[currentChecklistId];
            checklist.sectionStates[section] = !checklist.sectionStates[section];
            saveAllChecklists();
            renderChecklist();
        }

        // Toggle all sections
        function toggleAllSections() {
            const checklist = allChecklists[currentChecklistId];
            const allCollapsed = Object.values(checklist.sectionStates).every(s => s);
            Object.keys(checklist.sectionStates).forEach(section => {
                checklist.sectionStates[section] = !allCollapsed;
            });
            saveAllChecklists();
            renderChecklist();
        }

        // Update progress display
        function updateProgress() {
            const checklist = allChecklists[currentChecklistId];
            const totalTasks = checklist.totalTasks;
            const completedTasks = checklist.completedTasks;
            const percentage = checklist.progress;

            document.getElementById('progressPercentage').textContent = `${percentage}%`;
            document.getElementById('progressFill').style.width = `${percentage}%`;
            document.getElementById('completedCount').textContent = `${completedTasks} completed`;
            document.getElementById('totalCount').textContent = `${totalTasks} total tasks`;
            document.getElementById('remainingCount').textContent = `${totalTasks - completedTasks} remaining`;
        }

        // Export functions
        function showExportModal() {
            document.getElementById('exportModal').classList.add('show');
        }

        function hideExportModal() {
            document.getElementById('exportModal').classList.remove('show');
        }

        function exportAsText() {
            const checklist = allChecklists[currentChecklistId];
            let text = `RISE8 GROWTH CHECKLIST PROGRESS REPORT\n`;
            text += `======================================\n\n`;
            text += `Opportunity: ${checklist.opportunityName}\n`;
            text += `Type: ${checklist.proposalType.toUpperCase()}\n`;
            text += `Deadline: ${new Date(checklist.proposalDeadline).toLocaleDateString()}\n`;
            text += `Generated: ${new Date().toLocaleString()}\n\n`;

            text += `OVERALL PROGRESS: ${checklist.completedTasks}/${checklist.totalTasks} (${checklist.progress}%)\n\n`;

            // Add tasks by section
            const template = taskTemplates[checklist.proposalType];
            Object.keys(template).forEach(section => {
                text += `\n${section.toUpperCase()}\n`;
                text += '-'.repeat(section.length) + '\n';
                
                template[section].forEach((taskData, index) => {
                    const taskId = `${section}-${index}`;
                    const task = checklist.tasks[taskId];
                    const status = task?.completed ? '[✓]' : '[ ]';
                    const assignee = task?.assignedTo ? ` - ${task.assignedTo}` : '';
                    const due = task?.dueDate ? ` - Due: ${new Date(task.dueDate).toLocaleDateString()}` : '';
                    const hours = ` - ${task?.estimatedHours || 0}h`;
                    text += `${status} ${task.text}${assignee}${due}${hours}\n`;
                });
            });

            downloadFile(text, `${checklist.opportunityName.replace(/\s+/g, '_')}_checklist.txt`, 'text/plain');
            hideExportModal();
        }

        function exportAsCSV() {
            const checklist = allChecklists[currentChecklistId];
            let csv = 'Section,Task,Status,Assigned To,Due Date,Estimated Hours\n';
            
            const template = taskTemplates[checklist.proposalType];
            Object.keys(template).forEach(section => {
                template[section].forEach((taskData, index) => {
                    const taskId = `${section}-${index}`;
                    const task = checklist.tasks[taskId];
                    const status = task?.completed ? 'Complete' : 'Incomplete';
                    const assignee = task?.assignedTo || 'Unassigned';
                    const due = task?.dueDate || '';
                    const hours = task?.estimatedHours || 0;
                    csv += `"${section}","${task.text}","${status}","${assignee}","${due}","${hours}"\n`;
                });
            });

            downloadFile(csv, `${checklist.opportunityName.replace(/\s+/g, '_')}_checklist.csv`, 'text/csv');
            hideExportModal();
        }

        function exportAsJSON() {
            const checklist = allChecklists[currentChecklistId];
            const exportData = {
                ...checklist,
                exportDate: new Date().toISOString(),
                version: '1.0'
            };
            
            const json = JSON.stringify(exportData, null, 2);
            downloadFile(json, `${checklist.opportunityName.replace(/\s+/g, '_')}_backup.json`, 'application/json');
            hideExportModal();
        }

        function downloadFile(content, filename, mimeType) {
            const blob = new Blob([content], { type: mimeType });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            showToast(`Exported as ${filename}`, 'success');
        }

        // Reset progress
        function resetProgress() {
            if (confirm('Are you sure you want to reset all progress? This cannot be undone.')) {
                const checklist = allChecklists[currentChecklistId];
                Object.keys(checklist.tasks).forEach(taskId => {
                    checklist.tasks[taskId].completed = false;
                });
                checklist.completedTasks = 0;
                checklist.progress = 0;
                
                saveAllChecklists();
                renderChecklist();
                updateProgress();
                showToast('Progress reset', 'success');
            }
        }

        // Process integrations
        function processIntegrations(checklist) {
            const modal = document.getElementById('integrationModal');
            const log = document.getElementById('integrationLog');
            log.innerHTML = '';
            modal.classList.add('show');

            let steps = [];
            
            if (checklist.integrations.hubspot.enabled) {
                steps.push(() => createHubSpotDeal(checklist));
            }
            
            if (checklist.integrations.slack.enabled) {
                steps.push(() => postToSlack(checklist));
            }

            // Execute steps sequentially
            executeIntegrationSteps(steps, 0, checklist);
        }

        function executeIntegrationSteps(steps, index, checklist) {
            if (index >= steps.length) {
                document.getElementById('integrationDoneBtn').style.display = 'block';
                addLogEntry('✅ All integrations complete!', 'success');
                saveAllChecklists();
                return;
            }

            setTimeout(() => {
                steps[index]();
                executeIntegrationSteps(steps, index + 1, checklist);
            }, 1500);
        }

        function addLogEntry(message, type = 'info') {
            const log = document.getElementById('integrationLog');
            const entry = document.createElement('div');
            entry.className = `log-entry ${type}`;
            const timestamp = new Date().toLocaleTimeString();
            entry.innerHTML = `<span style="opacity: 0.6">[${timestamp}]</span> <span>${message}</span>`;
            log.appendChild(entry);
            log.scrollTop = log.scrollHeight;
        }

        function createHubSpotDeal(checklist) {
            addLogEntry('🔗 Connecting to HubSpot API...', 'info');
            
            setTimeout(() => {
                const dealId = 'DEAL-' + Math.random().toString(36).substr(2, 9).toUpperCase();
                checklist.integrations.hubspot.dealId = dealId;
                
                addLogEntry(`📊 Creating deal "${checklist.opportunityName}"...`, 'info');
                addLogEntry(`💰 Deal value: ${checklist.integrations.hubspot.dealValue || 'TBD'}`, 'info');
                addLogEntry(`📈 Pipeline: ${checklist.integrations.hubspot.pipeline}`, 'info');
                
                setTimeout(() => {
                    addLogEntry(`✅ HubSpot deal created: ${dealId}`, 'success');
                    addLogEntry(`🔗 View in HubSpot: https://app.hubspot.com/contacts/demo/deal/${dealId}`, 'info');
                }, 500);
            }, 500);
        }

        function postToSlack(checklist) {
            addLogEntry(`💬 Connecting to Slack workspace...`, 'info');
            
            setTimeout(() => {
                const channel = checklist.integrations.slack.channel;
                const threadTs = Date.now() / 1000;
                checklist.integrations.slack.threadTs = threadTs;
                
                addLogEntry(`📢 Posting to ${channel}...`, 'info');
                
                const message = `🚀 *New Proposal Checklist Created*\n` +
                    `*Opportunity:* ${checklist.opportunityName}\n` +
                    `*Type:* ${checklist.proposalType.charAt(0).toUpperCase() + checklist.proposalType.slice(1)}\n` +
                    `*Deadline:* ${new Date(checklist.proposalDeadline).toLocaleDateString()}\n` +
                    `*Total Tasks:* ${checklist.totalTasks}`;
                
                addLogEntry('📝 Message preview:', 'info');
                addLogEntry(message.replace(/\*/g, '').replace(/\n/g, '<br>'), 'info');
                
                setTimeout(() => {
                    addLogEntry(`✅ Posted to ${channel}`, 'success');
                    addLogEntry(`💬 Thread ID: ${threadTs}`, 'info');
                    
                    if (checklist.integrations.hubspot.enabled && channel === '#hubspot-updates') {
                        addLogEntry(`🔗 Linked to HubSpot deal ${checklist.integrations.hubspot.dealId}`, 'success');
                    }
                }, 500);
            }, 500);
        }

        function closeIntegrationModal() {
            document.getElementById('integrationModal').classList.remove('show');
            document.getElementById('integrationDoneBtn').style.display = 'none';
            showChecklistPage();
        }

        function syncIntegrations() {
            const checklist = allChecklists[currentChecklistId];
            
            if (!checklist.integrations || (!checklist.integrations.hubspot.enabled && !checklist.integrations.slack.enabled)) {
                showToast('No integrations configured for this checklist', 'error');
                return;
            }

            const modal = document.getElementById('integrationModal');
            const log = document.getElementById('integrationLog');
            log.innerHTML = '';
            modal.classList.add('show');

            addLogEntry('🔄 Syncing integrations...', 'info');

            // Sync HubSpot
            if (checklist.integrations.hubspot.enabled && checklist.integrations.hubspot.dealId) {
                setTimeout(() => {
                    addLogEntry(`📊 Updating HubSpot deal ${checklist.integrations.hubspot.dealId}...`, 'info');
                    addLogEntry(`📈 Progress: ${checklist.progress}%`, 'info');
                    addLogEntry(`✅ Tasks completed: ${checklist.completedTasks}/${checklist.totalTasks}`, 'info');
                    
                    setTimeout(() => {
                        addLogEntry('✅ HubSpot deal updated', 'success');
                    }, 1000);
                }, 1000);
            }

            // Update Slack
            if (checklist.integrations.slack.enabled && checklist.integrations.slack.threadTs) {
                setTimeout(() => {
                    addLogEntry(`💬 Updating Slack thread in ${checklist.integrations.slack.channel}...`, 'info');
                    
                    const updateMessage = `📊 *Progress Update*\n` +
                        `Progress: ${checklist.progress}%\n` +
                        `Completed: ${checklist.completedTasks}/${checklist.totalTasks} tasks`;
                    
                    addLogEntry('📝 Update message:', 'info');
                    addLogEntry(updateMessage.replace(/\*/g, '').replace(/\n/g, '<br>'), 'info');
                    
                    setTimeout(() => {
                        addLogEntry('✅ Slack thread updated', 'success');
                    }, 1000);
                }, 2000);
            }

            setTimeout(() => {
                document.getElementById('integrationDoneBtn').style.display = 'block';
                addLogEntry('✅ Sync complete!', 'success');
            }, 3500);
        }

        // Show checklist page with integrations
        function showChecklistPage() {
            document.getElementById('dashboardPage').classList.add('hidden');
            document.getElementById('landingPage').classList.add('hidden');
            document.getElementById('checklistPage').classList.remove('hidden');
            
            const checklist = allChecklists[currentChecklistId];
            
            // Update header
            document.getElementById('displayOpportunityName').textContent = checklist.opportunityName;
            const deadline = new Date(checklist.proposalDeadline);
            const daysUntil = Math.ceil((deadline - new Date()) / (1000 * 60 * 60 * 24));
            document.getElementById('displayDeadline').textContent = 
                `Due: ${deadline.toLocaleDateString()} (${daysUntil} days)`;
            
            // Show integration statuses
            const statusContainer = document.getElementById('integrationStatuses');
            statusContainer.innerHTML = '';
            
            if (checklist.integrations?.hubspot?.enabled && checklist.integrations.hubspot.dealId) {
                statusContainer.innerHTML += `
                    <span class="integration-status hubspot">
                        <span>🔗</span>
                        <span>HubSpot: ${checklist.integrations.hubspot.dealId}</span>
                    </span>
                `;
            }
            
            if (checklist.integrations?.slack?.enabled && checklist.integrations.slack.channel) {
                statusContainer.innerHTML += `
                    <span class="integration-status slack">
                        <span>💬</span>
                        <span>Slack: ${checklist.integrations.slack.channel}</span>
                    </span>
                `;
            }
            
            renderChecklist();
            updateProgress();
        }

        // Add event listeners for integration toggles
        document.addEventListener('DOMContentLoaded', () => {
            const hubspotCheckbox = document.getElementById('hubspotEnabled');
            const slackCheckbox = document.getElementById('slackEnabled');
            
            if (hubspotCheckbox) {
                hubspotCheckbox.addEventListener('change', (e) => {
                    document.getElementById('hubspotOptions').classList.toggle('hidden', !e.target.checked);
                });
            }
            
            if (slackCheckbox) {
                slackCheckbox.addEventListener('change', (e) => {
                    document.getElementById('slackOptions').classList.toggle('hidden', !e.target.checked);
                });
            }
            
            loadAllChecklists();
            showDashboard();
        });

        // Auto-save on visibility change
        document.addEventListener('visibilitychange', () => {
            if (document.hidden && currentChecklistId) {
                saveAllChecklists();
            }
        });
    </script>
</body>
</html>
